name: ğŸš€ Deploy Blazor WebAssembly (.NET 10) to GitHub Pages

on:
  push:
    branches: [ "main" ]     # Ø§Ø¬Ø±Ø§ Ø¨Ø§ Ù‡Ø± Push Ø±ÙˆÛŒ Ø´Ø§Ø®Ù‡ main
  workflow_dispatch:          # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ Ø§Ø² ØªØ¨ Actions

permissions:
  contents: write             # Ù…Ø¬ÙˆØ² Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ´ØªÙ† Ø¯Ø± Ø´Ø§Ø®Ù‡ gh-pages

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Û±ï¸âƒ£ Ú†Ú©â€ŒØ§ÙˆØª Ø³ÙˆØ±Ø³
      - name: Checkout repository
        uses: actions/checkout@v4

      # Û²ï¸âƒ£ Ù†ØµØ¨ SDK .NET 10
      - name: Setup .NET SDK (10.x)
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 10.0.x

      # Û³ï¸âƒ£ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ Ùˆ Ø¨ÛŒÙ„Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡
      - name: Restore and Build
        run: |
          dotnet restore
          dotnet publish JsonViewer.csproj -c Release -o release --nologo

      # Û´ï¸âƒ£ Ø§ØµÙ„Ø§Ø­ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ GitHub Pages
      - name: Prepare deployment content
        run: |
          # Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ù¾ÙˆØ´Ù‡ Ø®Ø±ÙˆØ¬ÛŒ
          mkdir -p release/wwwroot
          # Ø§ØµÙ„Ø§Ø­ base href Ø¨Ø±Ø§ÛŒ Ù…Ø³ÛŒØ± /JsonViewer/
          sed -i 's|<base href="/"|<base href="/JsonViewer/"|' release/wwwroot/index.html
          # Ø§ÙØ²ÙˆØ¯Ù† .nojekyll Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ø°Ù ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ±Ø´Ø§Ø®Ù‡
          echo "" > release/wwwroot/.nojekyll
          # Ø§ÛŒØ¬Ø§Ø¯ 404.html Ø¨Ø±Ø§ÛŒ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ SPA
          cp release/wwwroot/index.html release/wwwroot/404.html

      # Ûµï¸âƒ£ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø±ÙˆÛŒ Ø´Ø§Ø®Ù‡ gh-pages
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages         # Ø¨Ø±Ù†Ú† Ù…Ù‚ØµØ¯
          folder: release/wwwroot  # Ù…Ø³ÛŒØ± Ø®Ø±ÙˆØ¬ÛŒ Ù…Ù†ØªØ´Ø±Ø´Ø¯Ù‡
          clean: true              # Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ

      # âœ… Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ù„Ø§Ú¯â€ŒÙ‡Ø§
      - name: Deployment summary
        run: echo "âœ… Deployment completed successfully for .NET 10 Blazor WASM â†’ branch gh-pages"
